# Supabase Setup Guide for NeoRealm

This guide will walk you through setting up Supabase for the NeoRealm project, including how to get your credentials and configure the application.

## What is Supabase?

Supabase is an open-source Firebase alternative that provides a complete backend-as-a-service platform. It offers:

- **Database**: PostgreSQL database with real-time capabilities
- **Authentication**: User management with email, OAuth, and more
- **Storage**: File storage with public and private options
- **Edge Functions**: Serverless functions for custom logic
- **Realtime**: Real-time subscriptions to database changes
- **Dashboard**: Web-based interface for managing your project

## Setting Up Supabase for NeoRealm

### 1. Create a Supabase Account

1. Go to [https://supabase.com](https://supabase.com)
2. Click "Start your project" or "Sign in"
3. Sign up with your preferred method (GitHub, Google, or email)

### 2. Create a New Project

1. In the Supabase dashboard, click "New Project"
2. Fill in the project details:
   - **Project name**: `NeoRealm` (or any name you prefer)
   - **Database password**: Create a strong password (save this somewhere secure)
   - **Region**: Choose the region closest to you
3. Click "Create New Project"
4. Wait for the project to be provisioned (this may take a few minutes)

### 3. Get Your Project Credentials

Once your project is ready, you'll need to get your API credentials:

1. In your project dashboard, click on the "Settings" gear icon in the left sidebar
2. Click "API" in the settings menu
3. Copy the following values:
   - **Project URL**: This is your `SUPABASE_URL`
   - **Project API keys**: 
     - For frontend use, copy the `anon` key (this is your `SUPABASE_ANON_KEY`)
     - For backend/admin use, you can use the `service_role` key

### 4. Configure Environment Variables

In your NeoRealm project, you'll need to set up environment variables:

1. Open the `.env.local` file in the `neo-realm` directory
2. Replace the placeholder values with your actual Supabase credentials:

```env
NEXT_PUBLIC_SUPABASE_URL=your-actual-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-actual-supabase-anon-key
```

For example:
```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.your-token-here
```

### 5. Set Up Database Tables

The NeoRealm project requires specific database tables. You can create them using the SQL editor in Supabase:

1. In your Supabase dashboard, click on "Table Editor" in the left sidebar
2. Click the "SQL Editor" button
3. Copy and run the following SQL commands:

```sql
-- Profiles (Characters) table
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  username TEXT UNIQUE NOT NULL,
  avatar_url TEXT,
  character_class TEXT,
  bio TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Messages table
CREATE TABLE messages (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  user_id UUID REFERENCES profiles(id),
  content TEXT,
  message_type TEXT CHECK (message_type IN ('chat', 'action', 'dice_roll', 'system')),
  created_at TIMESTAMP DEFAULT NOW()
);

-- Followers table
CREATE TABLE followers (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  follower_id UUID REFERENCES profiles(id),
  following_id UUID REFERENCES profiles(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(follower_id, following_id)
);

-- Reactions table (Energy system)
CREATE TABLE reactions (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  user_id UUID REFERENCES profiles(id),
  message_id BIGINT REFERENCES messages(id),
  reaction_type TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS messages_created_at_idx ON messages (created_at);
CREATE INDEX IF NOT EXISTS followers_follower_id_idx ON followers (follower_id);
CREATE INDEX IF NOT EXISTS followers_following_id_idx ON followers (following_id);
CREATE INDEX IF NOT EXISTS reactions_message_id_idx ON reactions (message_id);
```

### 6. Configure Authentication

NeoRealm uses email/password authentication. You need to enable this in Supabase:

1. In your Supabase dashboard, click on "Authentication" in the left sidebar
2. Click on "Providers" in the authentication menu
3. Find "Email" in the list of providers
4. Toggle the switch to enable it
5. You can leave the default settings as they are

### 7. Set Up Realtime Subscriptions

The chat functionality requires realtime subscriptions:

1. In your Supabase dashboard, click on "Database" in the left sidebar
2. Click on "Replication" in the database menu
3. Toggle on "messages" table to enable replication
4. This allows the frontend to receive real-time updates when new messages are posted

### 8. Configure Edge Functions (Optional for Phase 1)

For the Architect bot functionality:

1. Install the Supabase CLI: `npm install -g supabase`
2. Login to Supabase: `supabase login`
3. Link your project: `supabase link --project-ref your-project-id`
4. Deploy functions: `supabase functions deploy`

Alternatively, you can use the provided deployment scripts:
- On Windows: Run `supabase-deploy.bat`
- On macOS/Linux: Run `supabase-deploy.sh`

After deployment, you can invoke the functions using the Supabase client:

```javascript
// Invoke architect-bot function
const { data, error } = await supabase.functions.invoke('architect-bot');

// Invoke welcome-user function (requires user data)
const { data, error } = await supabase.functions.invoke('welcome-user', {
  body: { record: { username: 'newuser' } }
});
```

Note: This requires the Supabase CLI and is optional for Phase 1.

## Testing Your Setup

After configuring everything:

1. Make sure your `.env.local` file has the correct credentials
2. Run the development server: cd in the `neo-realm` directory
3. Open your browser to `http://localhost:3000`
4. Try signing up for a new account
5. Create a character profile
6. Enter the terminal and send a message
7. Verify that messages appear in real-time

## Troubleshooting

### Common Issues

1. **Environment Variables Not Loading**:
   - Make sure you're using `.env.local` (not `.env`)
   - Restart your development server after changing environment variables
   - Check that there are no spaces around the `=` sign

2. **Database Connection Errors**:
   - Verify your `SUPABASE_URL` and `SUPABASE_ANON_KEY` are correct
   - Make sure you've created all the required tables

3. **Authentication Issues**:
   - Ensure email authentication is enabled in your Supabase project
   - Check that you're using the correct `anon` key (not the service key)

4. **Realtime Messages Not Working**:
   - Verify that the `messages` table has replication enabled
   - Check your browser's developer console for errors

### Getting Help

If you encounter issues:

1. Check the browser console for error messages
2. Check the Supabase dashboard for any alerts or issues
3. Refer to the [Supabase documentation](https://supabase.com/docs)
4. Visit the [Supabase Discord](https://discord.supabase.com/) for community support

## Security Considerations

1. **Never expose your service role key** in client-side code
2. **Use the anon key** for client-side operations
3. **Enable Row Level Security (RLS)** for production (optional for development)
4. **Rotate your keys** periodically for security
5. **Use environment variables** to keep credentials out of your source code

## Next Steps

After successfully setting up Supabase:

1. Test all functionality locally
2. Deploy your Next.js app to Vercel
3. Set the same environment variables in your Vercel project settings
4. Continue with Phase 2 development (Community Growth features)